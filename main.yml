- hosts:
    - all

  tasks:

    - name: Configure hosts
      import_role:
        name: common/docker_base
      tags:
        - install
        - configure
        - reset

    - name: Configure cluster
      import_role:
        name: common/k8s_base
      tags:
        - install
        - configure
        - bootstrap_master
        - bootstrap_worker
        - reset

    - name: Configure service mesh
      import_role:
        name: common/k8s_mesh
      run_once: yes
      when:
        - facted.kubernetes.roles is defined
        - facted.kubernetes.roles == master
      tags:
        - apply
        - delete
